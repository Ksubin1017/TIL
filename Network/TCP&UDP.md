# TCP & UDP

## TCP
- 신뢰할 수 있는 통신으로 상태 관리, 흐름 제어, 오류 제어, 혼잡 제어를 제공한다.
- 연결 수립, 종료 과정을 거친다.

## UDP
- 신뢰할 수 없는 통신으로 상태 관리, 흐름제어, 오류 제어, 혼잡 제어를 제공하지 않는다.
- 연결 수립, 종료 과정을 거치지 않는다.

> 신뢰 및 연결형 송수신에서는 시간과 연산이 소요되므로 일반적으로 TCP가 UDP보다 송수신 속도가 느리다.  
> - 패킷 유실 없는 송수신 시 -> TCP  
> - 비교적 빠른 송수신 시 -> UDP  

---

## 헤더

### UDP
- 헤더에 송신지 포트, 수신지 포트, 길이(패킷의 바이트 크기), 체크섬(송수신 과정에서의 데이터그램 훼손 여부) 필드가 존재한다.

### TCP
- 헤더에 UDP 헤더에 포함되어 있는 필드 및 순서 번호 필드, 확인 응답 번호 필드, 일부 제어 비트(ACK 플래그, SYN 플래그, FIN 플래그)를 포함한다.

#### 제어 비트
- **ACK**: 세그먼트의 승인을 나타내기 위한 비트  
- **SYN**: 연결을 수립하기 위한 비트  
- **FIN**: 연결을 종료하기 위한 비트  

#### 순서 번호 필드
- TCP 패킷의 올바른 송수신 순서를 보장하기 위해 세그먼트 첫 바이트에 매겨진 번호  
- 순서 번호를 통해 현재 주고받는 TCP 세그먼트가 송수신하고자 하는 데이터의 몇 번째 바이트에 해당하는 지 알 수 있다.

#### 확인 응답 번호
- 상대 호스트가 보낸 세그먼트에 대한 응답으로 다음으로 수신하길 기대하는 순서 번호  
- 일반적으로 올바르게 수신한 순서 번호에 +1한 값

**예시**
1. 호스트 A가 순서 번호 100 세그먼트를 호스트 B에 전달  
2. 호스트 B는 101번 세그먼트를 받기 원한다는 의미로 확인 응답 필드에 101을 명시해 호스트 A에 전달  
   - 호스트 B는 세그먼트가 확인 응답 번호를 포함하고 있음을 알리기 위해 ACK 플래그를 1로 설정  

---

## TCP의 오류, 흐름, 혼잡 제어

### 오류 제어
- 잘못 전송한 세그먼트가 있을 경우 재전송하여 오류를 제어  

1. **중복된 ACK 세그먼트가 도착했을 경우**  
   - 송신한 세그먼트의 일부가 전송 중 유실되어 중복으로 ACK 세그먼트를 수신하는 상황

2. **타임아웃이 발생했을 경우**  
   - TCP 세그먼트를 송신하는 호스트는 재전송 타이머 값을 가지고 있음  
   - 세그먼트를 전송할 때마다 재전송 타이머를 시작  
   - 타이머 카운트 다운이 끝난 시점까지 ACK 세그먼트를 받지 못하면 세그먼트를 재전송

### 흐름 제어
- 수신 호스트가 한 번에 받아 처리할 수 있을 만큼만 전송  
- 송신 호스트가 수신 호스트의 처리 속도를 고려하여 송수신 속도를 균일하게 맞추는 기능  
- TCP 헤더의 **윈도우 필드**에 수신 호스트가 한 번에 처리할 수 있는 수신 윈도우 크기가 명시됨

### 혼잡 제어
- 많은 트래픽으로 인해 패킷의 처리 속도가 느려지거나 유실될 수 있는 상황을 제어  
- 혼잡 제어의 주체는 송신 호스트  
- 혼잡 여부 판단 기준은 오류 제어 판단과 동일  
- 조건 발생 시 네트워크 혼잡으로 판단하며, 송신 호스트는 혼잡 없이 전송할 수 있는 만큼의 양(**혼잡 윈도우**)만 송신

---

## TCP의 연결과 종료

### 연결: 3-Way-Handshake
1. **A -> B, SYN 세그먼트 전송**  
   - 호스트 A는 SYN 비트가 1로 설정된 세그먼트를 호스트 B에게 전송  

2. **B -> A, SYN + ACK 세그먼트 전송**  
   - 호스트 B는 ACK 비트와 SYN 비트가 1로 설정된 세그먼트를 호스트 A에게 전송  

3. **A -> B, ACK 세그먼트 전송**  
   - 호스트 A는 ACK 비트가 1로 설정된 세그먼트를 호스트 B에게 전송  

### 종료: 4-Way-Handshake
1. **A -> B, FIN 세그먼트 전송**  
   - 호스트 A는 FIN 세그먼트를 호스트 B에게 전송  

2. **B -> A, ACK 세그먼트 전송**  
   - 호스트 B는 ACK 세그먼트를 호스트 A에게 전송  

3. **B -> A, FIN 세그먼트 전송**  
   - 호스트 B는 FIN 세그먼트를 호스트 A에게 전송  

4. **A -> B, ACK 세그먼트 전송**  
   - 호스트 A는 ACK 세그먼트를 호스트 B에게 전송
