# 스트림
Java 8부터 컬렉션 및 배열의 요소의 반복 처리를 함수형으로 처리할 수 있는 기술
일련의 데이터 프름을 표준화된 방법으로 쉽게 처리할 수 있도록 지원하는 클래스 집합


특징
- 내부 반복자이므로 처리 속도가 빠르고 병렬 처리에 효율적이다.
- 람다식으로 다양한 요소 처리를 정의할 수 있다.
- 중간 처리와 최종 처리를 수행하도록 파이프 라인을 형성할 수 있다.

## 내부 반복자
요소 처리 방법을 컬렉션 내부로 주입시켜 요소를 반복처리 하는 방식

외부 반복자일 경우 컬렉션의 요소를 외부로 가져오는 코드와 처리하는 코드를 모두 개발자 코드가 가지고 있어야하지만
내부 반복자의 경우 개발자 코드에서 제공한 처리 코드를 가지고 컬렉션 내부에서 요소를 반복 처리한다.

멀티 코어 CPU를 최대한 활용하기 위해 요소들을 분배시켜 병렬 작업이 가능하다.

## 중간 처리와 최종 처리
스트림은 하나 이상 연결될 수 있고 오리지널 스트림 뒤에 필터링 중간 스트림이 연결될 수 있다.
그 뒤에는 매핑 중간 스트림이 연결될 수 있는데 이와 같이 스트림이 연결되어 있는 것을 스트림 파이프라인 이라고 한다.

오리지널 스트림과 집계 처리 사이 중간 스트림들은 최종 처리를 위해 필터링, 매핑, 정렬하는 작업을 수행한다.
최종 처리는 중간 처리에서 정제된 요소들을 반복하거나 집계 작업을 수행한다.

```java
double avg = list.stream()
  .mapToInt(student -> student.getScore())
  .average()
  .getAsDouble();
```
위와 같이 스트림 파이프라인을 구성할 수 있으며 파이프라인의 맨 끝에는 반드시 최종 처리 부분이 있어야한다.
최종 처리가 존재하지 않는 경우 오리지널 및 처리 스트림은 동작하지 않는다.

## 리소스
java.util.stream 패키지에는 스트림 인터페이스들이 있고 BaseStream 인터페이스를 부모로 한 자식 인터페이스들이 관계를 이루고 있다.
자식 인터페이스: Stream, IntStream, LongStream, DoubleStream

BaseStream에는 모든 스트림에서 사용할 수 있는 공통 메서드들이 정의되어있다.

## 필터링
요소를 걸러내는 중간 처리 기능
distinct(), filter()가 존재한다.

### distinct()
요소의 중복을 제거하는 메서드
객체 스트림일 경우 equals() 메서드의 리턴값이 true면 동일한 요소로 판단하고 IntStream, LongStream, DoubleStream일 경우 같은 값일 경우 중복을 제거한다.

### filter()
매개값으로 주어진 Predicate가 true를 리턴하는 요소만 필터링한다.
Predicate는 함수형 인터페이스로 모든 Predicate는 매개값을 조사한 후 boolean을 리턴하는 test() 메서드를 가지고 있다.

## 요소 병렬 처리
멀티코어 CPU 환경에서 전체 요소를 분할해서 각각의 코어가 병렬적으로 처리하는 것
작업 처리 시간을 줄이는 것이 목적이며 자바는 이를 위해 병렬 스트림을 제공한다.

### 병렬 처리 성능
스트림 순차 처리보다 스트림 병렬 처리가 항상 실행 성능이 좋다고 판단해서는 안되며 아래 3가지 요인을 확인해야한다.

- 요소의 수와 요소당 처리 시간
전체 요소의 수가 적고 요소당 처리 시간이 짧다면 일반 스트림이 더 빠를 수 있다.
병렬 처리는 포크 및 조인 단계, 스레드 풀을 생성하는 추가적인 비용이 발생하기 때문이다.

- 스트림 소스의 종류
ArrayList와 배열은 인덱스로 요소를 관리하기 때문에 포크 단계에서 요소를 쉽게 분리할 수 있어 병렬 처리 시간이 절약되지만
HashSet, TreeSet은 요소 분리가 쉽지 않고 LinkedList의 경우 링크를 추적해야하므로 병렬 처리가 늦다.

- 코어의 수
CPU 코어가 많을 수록 병렬 스트림의 성능이 좋아지고, 코어 수가 적을 경우는 일반 스트림이 더 빠를 수 있다.
병렬 스트림은 스레드 수가 증가하여 동시성이 많이 일어나므로 느려진다.
